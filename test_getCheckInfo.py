import dingtalk.api
import json
import pymssql
import datetime
access_token ="5424fd25e7ed3fccb94e42ec4b456cb7"
onjobUserlist = ['1221640427698050', '281416406237723557', '300149196220845176', '662139322431114865', '192714496920168318', '042540505136651902', '0156633421784530', '0122194461501176611', '01080431435238942344', '01503069301229806', '0111560840271185975', '395950366036700538', '01221935653526327648', '081027353024251235', '11390940591071639', '0431120442904973', '28116621691150612', '012219342539937845', '141944665421382612', '01221935051035531371'], ['095519091521599832', '156039474720004353', '0638100227780831', '110456366126610606', '01221909342025767369', '171261622324551103', '095747646332212122', '270964583221164738', '241142142839201227', '311532184821104207', '2855066832747184', '075725461930700431', '123740293626183033', '213607365624232307', '01221913364636714875', '011221514030839855', '410028244937919280', '0823004740955109', '2516543514937967', '01100806636836673787'], ['01221903534521754947', '204430536329167383', '485617135423243612', '133053293126707688', '021266605729590692', '232720341132557652', '47524715461215673', '1227101311849372', '235920695524318183', '200260085920426867', '142212042721380715', '12581307161222422', '220730465426252911', '3035525418780008', '1031501139689560', '1765085266880614', '01221867475520788309', '01221864015226216906', '672620306032850916', '01220051071932417868'], ['012039413568788585', '186830624439954676', '193720294121011520', '01030316182236679545', '085620305423167976', '1515044442691183', '141729071226140786', '2421451154-2067905998', '492632345121085085', '285207635226168403', '2668462136528301', '6429224823924440', '211141381624102314', '6252444943-1768042391', '62666936101256266', '624654210821568366', '1946505639844761', '621834635326062262', '2900531361954944', '613853463624242602'], ['614102463738010264', '3109092331841596', '265437564326237252', '221610230524347289', '33686126301226577', '1727446813809838696', '211141380733353942', '282640141736333933', '225159153226707517', '5456145541787648', '020300594420274154', '2240065017668265', '361062596729265179', '391909454923785194', '361453583929099705', '361144213926595138', '274523142940197351', '360808411421593298', '252012475428758327', '4134003332788029'], ['360555594139736696', '360250586226062939', '4103395957659369', '09242866001174509', '360117065429276226', '3603672151850748', '360369063523301875', '315306411323842347', '2037624333841161', '3608084112949685', '3608084060793650', '10200208321234884', '214931073324204535', '361761510821217816', '402804166925757169', '360808411036307357', '361203583229176044', '360808411638010223', '360808410524073823', '3615423842701020'], ['262253623726365890', '116165583121288093', '362731211229731121', '186456583621594215', '016702304534434533', '360664561529172283', '360808406822947774', '360658474421408956', '2929630753776103', '360808406926080488', '360808406432692510', '3604602447672822', '360808406226411007', '360404582126081742', '352615405838688308', '251711621326767388', '360808406524236052', '110216676538769779', '3613636868793559', '361325154839847451'], ['326133475021400476', '175533614823794996', '30185346181230167', '010651132433260922', '1241336932845176', '3608084108678922', '22471331041230725', '201800634726087684', '360936571235593204', '136050332129616077', '306031451238741506', '36085642311994375250', '042742102726072225', '36032235161203807', '1625021541937530', '390856121035120642', '08296515281081475', '011349561638882290', '385106055236835225', '113824322138262152'], ['385012516526324689', '084562685131633874', '3849114851839855', '3613423047790108', '186745240820219290', '071705641159431', '111845352924074931', '360459643236340492', '266622063126274796', '384005284121546641', '11066947071173577', '383502053326391496', '380559075427430943', '222757611427742446', '2232641042699158', '262505355136487297', '375468054826030382', '143110321119844240', '360808411132456356', '252706045429566197'], ['134706623620300672', '361203652338828614', '361534686735683309', '36011465621183956', '14011545141241597', '025332670338936265', '141704015726039136', '374903132836024833', '281558045826117034', '093060250330772470', '043635623023254547', '290227572421386985', '2057382030846567', '216635565421374324', '01541129281083937', '2718682729650067', '3600304057952770', '082852426932749917', '293616551426101620', '101238161529094574'], ['253510071026596183', '133051561024345678', '372816341724074612', '133237463233325837', '370757570836501310', '366411263426484562', '4648096224186959', '296341440320242966', '106606584920242966', '3617046119649958', '360808410238013439', '233563044032853164', '363733113034346117', '2218023018639294', '551210481150612', '363645306926071366', '360818396830383498', '362549041227235829', '361320276126070293', '362266545729362302'], ['3608084101918372', '362061366721876030', '362054230624451895', '146510445426182891', '361942150623414718', '124623215726261837', '36190640671183541', '26061324141214096', '3608084066780847', '360517180326311555', '3604200411777276', '360529664126249603', '361705073324125632', '36136953211231015', '081201632919996467', '360755424021040390', '3616462350937204', '361015382235594416', '252562481627160715', '361565256924411035'], ['015806043624344315', '360448670824246148', '016733602824171669', '294358501735468655', '1868340828775765', '361515075824435976', '360653323121945558', '3606533232-1674788614', '360430290126604685', '105534433824478592', '1513260439845745', '200953132030932689', '154806431529140136', '361231385523310505', '182752012922890611', '106348630226222580', '055460532321691831', '3612303362950029', '244609586920987997', '361146660420970060'], ['034827362832877407', '10144533311165398935', '361055635823201531', '360864652631047969', '1062022916682655', '2559672116775726', '35696437001170601', '02152849071136682', '360929193738359989', '2541075612784319', '032956524626028962', '360764652328497641', '210440421624273933', '360935163431012663', '012439614435486629', '36090442451225954', '3609141048791141', '360912196127404068', '074020570637751820', '360718530220970919'], ['360713003523291737', '360722025924126349', '102566361721921908', '3568393460695941', '296910513533311582', '126218522929192771', '293948082229181100', '360765113439709732', '122430035326404110', '323136021726055622', '1961495616685489', '131706164026249468', '125429384429492363', '100817234026654446', '124548672236483014', '312209361127752693', '360741572126309659', '163146392237913023', '284328204432563520', '31164843451034272'], ['2629134535779290', '2243525420164883', '3607055905944958', '0226204724694094', '282466582825975984', '102321206124256477', '0854052740666107', '360657000738203177', '133831465537802374', '296935632226221521', '181135424635441493', '360627295124079310', '360525484920981073', '360364462124162520', '36061946011054066', '291348145021591924', '36040457331120412', '2810066960739643', '1221623555707298', '0540050062784779'], ['096611245620326887', '3605585914839851', '274010540921554653', '133040175423484272', '254301034921275448', '294319504821666008', '034243595929654388', '113805555420947190', '253442670229397581', '064064116321417599', '12595644451213213', '3604643021922064', '360018196325767369', '126066593024479808', '0138195634848113', '150954615536351917', '1512395941672471', '025623144523739073', '360322171419937073', '226306121423316592'], ['095903673927191585', '250551374032506817', '223561672929069722', '083067216137813384', '272044670829669760', '0442451665789306', '224435463620272682', '08533767291038016', '3602350801675874', '025244095124256108', '0121036732943468', '032725591724552691', '043764310329254843', '054408095527973725', '276707540432877590', '3601405737848305', '3600263430839968', '356924614424102548', '2826621417652578', '276427293626160125'], ['021340165820038019', '011736491727444666', '246866383526624634', '356956100721369198', '325441091043758', '35685422201134664', '0105365945840076', '2058461037762061', '113228132724134163', '3568023630795439', '020011592626691849', '356803610837808212', '322068000235784525', '0621682208668621', '35680155051146782', '3567464654942945', '0458345315936974', '022734121220367550', '172515070333533449', '23000633171284559'], ['1727482336947871', '135823492021442909', '1125531450791657', '014721260226429618', '232019232536839749', '09525928531174553', '013347502935260545', '3566602148950428', '125259226820111782', '0950265956850533', '250749281132219900', '022935515930625665', '226451694736570797', '14330043261169683', '27633140411238851', '29586221571294138', '032916683739893901', '234850022439895460', '12141365321255688', '205016200924860371']

# print(startdate)
# print(enddate)
class connectDingTalk():
    def getCheckinfo(self,checklist):
        checkDateFrom = datetime.datetime.strftime(datetime.date.today(),"%Y-%m-%d 00:00:00")
        checkDateTo = datetime.datetime.strftime(datetime.date.today(),"%Y-%m-%d 23:59:59")
        req=dingtalk.api.OapiAttendanceListRequest("https://oapi.dingtalk.com/attendance/list")
        req.workDateFrom=checkDateFrom
        req.workDateTo=checkDateTo
        # req.userIdList=['135823492021442909','135823492021442909']
        req.userIdList = ['1221640427698050', '281416406237723557', '300149196220845176', '662139322431114865', '192714496920168318', '042540505136651902', '0156633421784530', '0122194461501176611', '01080431435238942344', '01503069301229806', '0111560840271185975', '395950366036700538', '01221935653526327648', '081027353024251235', '11390940591071639', '0431120442904973', '28116621691150612', '012219342539937845', '141944665421382612', '01221935051035531371']
        req.offset=0
        req.limit=2
        try:
            resp= req.getResponse(access_token)
            print(resp)
        except Exception as e:
            print(e)
    def loopCheckInfo(self):
    # 拿到onjobUserlist每次取出50条userid查找考勤数据，直到结束
        step = 20
        c = [onjobUserlist[i:i+step] for i in range(0,len(onjobUserlist),step)]
        print(c)
        print("userlist分段数")
        print(len(c))
        for j in range(len(c)):
            print(type(c[j]))
            print(len(c[j]))
            connectDingTalk.getCheckinfo(self,c[j])
        global checklist
        checklist = c[0]
run = connectDingTalk()
run.loopCheckInfo()
